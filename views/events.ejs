<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Dashboard</title>
  <style>
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fefefe;
      padding: 20px;
      border: 1px solid #888;
      width: 300px;
    }

    .close {
      position: absolute;
      top: 0;
      right: 0;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <h2>Event Dashboard</h2>

  <form action="/dashboard" method="post">
    <label for="filterBy">Filter by:</label>
    <select id="filterBy" name="filterBy">
      <option value="organizerEmail">Organizer's Email</option>
      <option value="organizerPhoneNumber">Organizer's Phone Number</option>
      <option value="eventDate">Event Date</option>
      <option value="eventTime">Event Time</option>
      <option value="eventVenue">Event Venue</option>
      <option value="eventOrganizer">Event Organizer</option>
    </select>
    <input type="text" id="filterValue" name="filterValue" placeholder="Enter a value">
    <button type="submit">Filter</button>
  </form>

  <% if (user && user.role=='admin' ) { %>
    <button type="button" class="addEventBtn" onclick="openAddEventModal()">Add Event</button>
    <% } %>

      <% if (events.length> 0) { %>
        <ul>
          <% events.forEach(event=> { %>
            <li>
              <h3>
                <%= event.eventname %>
              </h3>
              <p>Description: <%= event.eventdescription %>
              </p>
              <p>Date: <%= event.eventdate.toDateString() %>
              </p>
              <p>Time: <%= event.eventtime %>
              </p>
              <p>Venue: <%= event.eventvenue %>
              </p>
              <p>Organizer: <%= event.eventorganizer %>
              </p>
              <p>Organizer's Email: <%= event.eventorganizeremail %>
              </p>
              <p>Organizer's Phone Number: <%= event.eventorganizerphonenumber %>
              </p>
              <% if (user && user.role=='admin' ) { %>
                <form action="/delete-event/<%= event._id %>?_method=DELETE" method="post">
                  <button type="submit">Delete</button>
                </form>

                <% } %>
                  <button type="button" class="registerBtn" data-eventname="<%= event.eventname %>"
                    data-eventid="<%= event._id %>">Register</button>

                  <!-- Edit event form -->
            </li>
            <% }); %>
        </ul>
        <% } else { %>
          <p>No events available.</p>
          <% } %>
            <p><a href="/">Go back to Home</a></p>
            <div id="registrationModal" class="modal">
              <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>


                <!--Registration div-->
                <h2>Event Registration</h2>
                <form id="registrationForm" method="post" action="/analysis">
                  <input type="hidden" id="eventNameInput" name="eventName" required>
                  <input type="hidden" id="eventIdInput" name="eventId" required>
                  <label for="participantName">Name:</label>
                  <input type="text" id="participantName" name="participantName" required>
                  <label for="Organizationname">Organization:</label>
                  <input type="text" id="Organizationname" name="Organizationname" required>
                  <button type="submit">Register</button>
                </form>
              </div>
            </div>

            <!--Create event div-->
            <div id="addEventModal" class="modal">
              <div class="modal-content">
                <span class="close" onclick="closeAddEventModal()">&times;</span>

                <h2>Add Event</h2>
                <form id="addEventForm" method="post" action="/create-event">
                  <label for="eventname">Event Name:</label>
                  <input type="text" id="eventname" name="eventname" required>

                  <label for="eventdescription">Event Description:</label>
                  <textarea id="eventdescription" name="eventdescription" required></textarea>

                  <label for="eventdate">Event Date:</label>
                  <input type="date" id="eventdate" name="eventdate" required>

                  <label for="eventtime">Event Time:</label>
                  <input type="text" id="eventtime" name="eventtime" required>

                  <label for="eventvenue">Event Venue:</label>
                  <input type="text" id="eventvenue" name="eventvenue" required>

                  <label for="eventorganizer">Event Organizer:</label>
                  <input type="text" id="eventorganizer" name="eventorganizer" required>

                  <label for="eventorganizeremail">Organizer's Email:</label>
                  <input type="email" id="eventorganizeremail" name="eventorganizeremail" required>

                  <label for="eventorganizerphonenumber">Organizer's Phone Number:</label>
                  <input type="tel" id="eventorganizerphonenumber" name="eventorganizerphonenumber" required>

                  <button type="submit">Create Event</button>
                </form>
              </div>
            </div>
            <!--Edit event-->

            <div id="editEventModal" class="modal">
              <div class="modal-content">
                <span class="close" onclick="closeEditEventModal()">&times;</span>

                <h2>Edit Event</h2>
                <form id="editEventForm" method="post" action="/edit-event/:id">
                  <!-- Add a hidden field for method override -->
                  <input type="hidden" name="_method" value="PUT">

                  <label for="eventname-e">Event Name:</label>
                  <input type="text" id="eventname-e" name="eventname" required>

                  <label for="eventdescription-e">Event Description:</label>
                  <textarea id="eventdescription-e" name="eventdescription" required></textarea>

                  <label for="eventdate-e">Event Date:</label>
                  <input type="date" id="eventdate-e" name="eventdate" required>

                  <label for="eventtime-e">Event Time:</label>
                  <input type="text" id="eventtime-e" name="eventtime" required>

                  <label for="eventvenue-e">Event Venue:</label>
                  <input type="text" id="eventvenue-e" name="eventvenue" required>

                  <label for="eventorganizer-e">Event Organizer:</label>
                  <input type="text" id="eventorganizer-e" name="eventorganizer" required>

                  <label for="eventorganizeremail-e">Organizer's Email:</label>
                  <input type="email" id="eventorganizeremail-e" name="eventorganizeremail" required>

                  <label for="eventorganizerphonenumber-e">Organizer's Phone Number:</label>
                  <input type="tel" id="eventorganizerphonenumber-e" name="eventorganizerphonenumber" required>

                  <button type="submit">Save Changes</button>
                </form>
              </div>
            </div>
</body>
<script>


  // Function to show the modal
  function openModal() {
    document.getElementById('registrationModal').style.display = 'block';
  }

  // Function to hide the modal
  function closeModal() {
    document.getElementById('registrationModal').style.display = 'none';
  }

  document.addEventListener('click', function (event) {
    if (event.target.classList.contains('registerBtn')) {
      eventId = event.target.getAttribute('data-eventid');
      const eventName = event.target.getAttribute('data-eventname');

      document.getElementById('eventNameInput').value = eventName;
      document.getElementById('eventIdInput').value = eventId;

      // Show the registration modal
      openModal();
    }
  });
  function openEditEventModal(eventData) {
    // Parse the JSON string to get the event object
    const event = JSON.parse(eventData);

    // Use the event data to populate the edit form
    document.getElementById('eventname-e').value = event.eventname;
    document.getElementById('eventdescription-e').value = event.eventdescription;
    document.getElementById('eventdate-e').value = event.eventdate.split('T')[0]; // Extract date part
    document.getElementById('eventtime-e').value = event.eventtime;
    document.getElementById('eventvenue-e').value = event.eventvenue;
    document.getElementById('eventorganizer-e').value = event.eventorganizer;
    document.getElementById('eventorganizeremail-e').value = event.eventorganizeremail;
    document.getElementById('eventorganizerphonenumber-e').value = event.eventorganizerphonenumber;

    // Show the edit event modal
    document.getElementById('editEventModal').style.display = 'block';
  }
  // function to display create event
  function openAddEventModal() {
    document.getElementById('addEventModal').style.display = 'block';
  }

  function closeAddEventModal() {
    document.getElementById('addEventModal').style.display = 'none';
  }

  document.getElementById('addEventBtn').addEventListener('click', function () {
    openAddEventModal();
  });




</script>


</html>